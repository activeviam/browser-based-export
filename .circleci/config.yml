version: 2
jobs:
  build:
    docker:
      # Closest available image to 6.5.0 which is the version of Node.js on Azure functions.
      # We use the image with browsers included to be able to use Chromium.
      # See https://hub.docker.com/r/circleci/node/tags/
      # See https://docs.microsoft.com/en-us/azure/azure-functions/functions-reference-node#node-version-and-package-management
      # See https://docs.aws.amazon.com/lambda/latest/dg/current-supported-versions.html
      - image: circleci/node:6.12-browsers
    steps:
      - checkout
      - run: yarn install
      - run: yarn run prettier --list-different
      - run: yarn run eslint
      - run:
          command: yarn run test --coverage --testResultsProcessor="jest-junit"
          environment:
            JEST_JUNIT_OUTPUT: "reports/junit.xml"
      - store_test_results:
          path: reports
      - store_artifacts:
          path: coverage/lcov-report
          destination: coverage
